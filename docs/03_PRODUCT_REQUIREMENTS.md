# 03. Product Requirements

## 1. Product goal

Пользователь должен иметь возможность формализовать собственный Buffett-style подход в виде набора метрик, запускать скрининг по universe компаний, сохранять условия и получать оповещения о новых совпадениях.

## 2. User stories

### US-01. Создать и сохранить экран
Как инвестор,
я хочу задать условия отбора,
чтобы быстро получать список компаний, соответствующих моим правилам.

### US-02. Смотреть объяснение по компании
Как инвестор,
я хочу открыть карточку компании,
чтобы увидеть расчет метрик и понять, почему компания прошла / не прошла фильтр.

### US-03. Менять правила без переписывания системы
Как инвестор,
я хочу расширять и изменять метрики,
чтобы развивать свой подход по мере изучения литературы и опыта.

### US-04. Получать сигналы автоматически
Как инвестор,
я хочу получать email-оповещения,
чтобы не проверять рынок вручную слишком часто.

### US-05. Пересматривать результаты со временем
Как инвестор,
я хочу видеть историю запусков и совпадений,
чтобы понимать динамику отбора.

## 3. MVP functional scope

## 3.1. Universe management

Система должна уметь:
- хранить universe компаний США;
- обновлять listing metadata;
- фильтровать universe по exchange / sector / industry / market cap category;
- исключать delisted / broken entries.

## 3.2. Data ingestion

Система должна:
- загружать prices;
- загружать базовые company profile fields;
- загружать annual financial statements, насколько дает provider;
- логировать статус загрузки;
- повторно запускать ingestion без дублей.

## 3.3. Metrics engine

Система должна:
- считать пользовательские метрики;
- считать их по версиям правил;
- хранить intermediate values;
- указывать статус достаточности данных;
- уметь пересчитывать метрики по измененной версии правил.

## 3.4. Screening engine

Система должна:
- выполнять screening по заданному набору правил;
- поддерживать hard filters и score-based ranking;
- сортировать по итоговому score и отдельным метрикам;
- сохранять результат screen run.

## 3.5. UI - screening table

Таблица должна поддерживать:
- поиск по тикеру / названию;
- сортировку;
- column filters;
- preset views;
- сохранение screen definition;
- переход в карточку компании.

## 3.6. Company detail page

Карточка компании должна показывать:
- базовую информацию;
- сырые используемые значения;
- производные метрики;
- итоговую оценку;
- explanation block;
- coverage / confidence / data sufficiency.

## 3.7. Alerts

Пользователь должен иметь возможность:
- создать alert rule на базе saved screen;
- задать frequency;
- выбрать email channel;
- получать только новые совпадения или изменение статуса компании.

## 4. V1 metrics set

## 4.1. Зафиксированные scope decisions

- регион покрытия v1: только США;
- режим использования: single-user, private-only;
- канал оповещений v1: email;
- quality screener остается основой продукта;
- PE разрешен в v1 как вспомогательная valuation-adjacent метрика без построения отдельного valuation layer.

## 4.2. Стартовый набор метрик

Ниже не окончательный "канон", а стартовый набор для первой версии engine.

### Hard / soft metrics v0

1. Gross margin threshold
   - условие: gross margin > 70%

2. Net margin threshold
   - условие: net margin > 40%

3. ROE threshold
   - условие: порог задается в screen definition

4. Revenue growth - 3 years
   - классификация: 1 / 0 / -1

5. Revenue growth - 10 years
   - классификация: 1 / 0 / -1

6. Net income growth - 3 years
   - классификация: 1 / 0 / -1

7. Net income growth - 10 years
   - классификация: 1 / 0 / -1

8. PE ratio
   - используется как reference metric или optional guardrail
   - полноценный valuation layer в MVP не строится

### Важно
Все эти правила должны быть конфигурируемыми, а не зашитыми в код как "вечная истина".

## 5. Non-functional requirements

### NFR-01. Explainability
По любой компании результат должен быть объясним.

### NFR-02. Reproducibility
Повторный запуск с теми же правилами и теми же входными данными должен давать тот же результат.

### NFR-03. Auditability
Должно быть видно:
- когда считалась метрика;
- какой provider использовался;
- какая версия правила применялась.

### NFR-04. Extensibility
Добавление новой метрики не должно требовать переписывания половины проекта.

### NFR-05. Graceful degradation
Если данные неполные, система должна помечать это явно, а не тихо искажать результат.

### NFR-06. Maintainability
Стек должен быть обычным, поддерживаемым и понятным для AI-assisted разработки.

## 6. Explicit non-goals

В MVP не делаем:
- полноценную auth subsystem;
- автосборку инвестиционного портфеля;
- постановку заявок в IBKR;
- аналитический чат на LLM как core feature;
- ingestion новостей как обязательную часть score;
- сложные forecasting models.

## 7. Acceptance criteria for MVP

MVP можно считать готовым, когда:

1. есть universe компаний;
2. есть расчет стартовых метрик минимум по одному provider;
3. можно задать и сохранить screen;
4. можно увидеть объяснение по компании;
5. работают email alerts;
6. можно пересчитать ruleset после изменения порогов;
7. код не привязан жёстко к Yahoo;
8. система работает в single-user режиме без логина.
